<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="116,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Get normalized entropy from spectral power range.</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T13U3">entr</span> = get_spectral_entropy(<span class="var type1" id="S3T11U6">power_range</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="116,3" id="srcline3"> 3</a></span><span class="line">  coder.extrinsic(<span class="string">'warning'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="116,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,5" id="srcline5"> 5</a></span><span class="line">  <span class="keyword">if</span> <span class="mxinfo " id="T16:U3"><span class="mxinfo " id="T1:U4">size(<span class="var type1" id="S3T11U18">power_range</span>,1)</span> == <span class="mxinfo " id="T1:U6">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="116,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T11:U7"><span class="var type1" id="S3T11U23">power_range</span> = <span class="var type1" id="S3T11U25">power_range</span>(:)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,7" id="srcline7"> 7</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   A = sqrt(power_range);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,10" id="srcline10">10</a></span><span class="line">  <span class="comment">% Make spectrum a PDF</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,11" id="srcline11">11</a></span><span class="line">  <span class="mxinfo " id="T11:U10"><span class="var type1" id="S3T11U29">power_range</span> = <span class="mxinfo " id="T11:U12">bsxfun(@rdivide, <span class="var type1" id="S3T11U34">power_range</span>, <span class="mxinfo " id="T13:U14">sum(<span class="var type1" id="S3T11U37">power_range</span>,1)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,12" id="srcline12">12</a></span><span class="line">  <span class="comment">% Happens when whole spectrum range has 0 power.</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,13" id="srcline13">13</a></span><span class="line">  <span class="mxinfo " id="T15:U16"><span class="mxinfo " id="T15:U17"><span class="var type1" id="S3T11U42">power_range</span>(<span class="mxinfo " id="T83:U19"><span class="mxinfo " id="T83:U20">isnan(<span class="var type1" id="S3T11U46">power_range</span>)</span> | <span class="mxinfo " id="T83:U22"><span class="var type1" id="S3T11U48">power_range</span>==<span class="mxinfo " id="T1:U24">0</span></span></span>)</span> = <span class="mxinfo " id="T1:U25">1E-100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,14" id="srcline14">14</a></span><span class="line">  <span class="comment">% Use normalized entropy.</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,15" id="srcline15">15</a></span><span class="line">  <span class="mxinfo " id="T13:U26"><span class="var type1" id="S2T13U53">entr</span> = <span class="mxinfo " id="T13:U28"><span class="mxinfo " id="T13:U29">-<span class="mxinfo " id="T13:U30">sum(<span class="mxinfo " id="T11:U31"><span class="var type1" id="S3T11U59">power_range</span>.*<span class="mxinfo " id="T11:U33">log2(<span class="var type1" id="S3T11U62">power_range</span>)</span></span>)</span></span> / <span class="mxinfo " id="T1:U35">log2(<span class="mxinfo " id="T1:U36">size(<span class="var type1" id="S3T11U67">power_range</span>,1)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,16" id="srcline16">16</a></span><span class="line">  <span class="keyword">if</span> <span class="mxinfo " id="T16:U38">any(<span class="mxinfo " id="T88:U39">isnan(<span class="var type1" id="S2T13U75">entr</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T63:U41"><span class="extrinsicFcn" id="F968N10:B78">warning</span>(<span class="mxinfo " id="T108:U42"><span class="string">'Entropy has NaN values'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,18" id="srcline18">18</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,19" id="srcline19">19</a></span><span class="line">  <span class="keyword">if</span> <span class="mxinfo " id="T16:U43">any(<span class="mxinfo " id="T88:U44">isinf(<span class="var type1" id="S2T13U86">entr</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T63:U46"><span class="extrinsicFcn" id="F969N10:B89">warning</span>(<span class="mxinfo " id="T108:U47"><span class="string">'Entropy has Inf values'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,21" id="srcline21">21</a></span><span class="line">  <span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="116,22" id="srcline22">22</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="116,23" id="srcline23">23</a></span><span class="line"><span class="comment">%       f30bpm = 5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,24" id="srcline24">24</a></span><span class="line"><span class="comment">%       f200bpm = 21;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,25" id="srcline25">25</a></span><span class="line"><span class="comment">%       </span></span></span>
<span class="srcline"><span class="lineno"><a href="116,26" id="srcline26">26</a></span><span class="line"><span class="comment">%       Acam_pow_norm = bsxfun(@rdivide, power_range, sum(power_range,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,27" id="srcline27">27</a></span><span class="line"><span class="comment">%       pct_in_hr = sum(Acam_pow_norm(f30bpm:f200bpm,:),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,28" id="srcline28">28</a></span><span class="line"><span class="comment">%       max_over_mean = max(Acam_pow_norm(f30bpm:f200bpm,:),[],1)./mean(Acam_pow_norm(f30bpm:f200bpm,:),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,30" id="srcline30">30</a></span><span class="line"><span class="comment">%       entr = entr./max(Acam_pow_norm(f30bpm:f200bpm,:),[],1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,31" id="srcline31">31</a></span><span class="line"><span class="comment">%       entr = 1./entr;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,32" id="srcline32">32</a></span><span class="line"><span class="comment">%       entr = max(Acam_pow_norm(f30bpm:f200bpm,:),[],1)./entr;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,33" id="srcline33">33</a></span><span class="line"><span class="comment">%       entr = entr.*(1-pct_in_hr);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,34" id="srcline34">34</a></span><span class="line"><span class="comment">%       entr = entr.*(pct_in_hr&lt;.2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,35" id="srcline35">35</a></span><span class="line"><span class="comment">%       entr = pct_in_hr&gt;.5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,36" id="srcline36">36</a></span><span class="line"><span class="comment">%       entr = pct_in_hr;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,37" id="srcline37">37</a></span><span class="line"><span class="comment">%       a = .7165; b = 14.9;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,38" id="srcline38">38</a></span><span class="line"><span class="comment">%       x = 1-pct_in_hr;</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,39" id="srcline39">39</a></span><span class="line"><span class="comment">%       entr = entr.*(a*log(b*x./(1-x)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,40" id="srcline40">40</a></span><span class="line"><span class="comment">%       entr = pct_in_hr;</span></span></span>
</pre>
